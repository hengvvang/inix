# Niri macOS Tahoe 流体玻璃透明度系统

## 概述

本文档描述了为 niri 窗口管理器配置的 macOS Tahoe 风格流体玻璃透明度系统。该系统基于窗口的聚焦状态和应用类型提供分层的透明效果，创造出优雅的视觉层次感。

## 核心设计理念

### 1. 聚焦状态驱动的透明度层次

- **聚焦窗口**：低透明度（0.95），确保当前工作内容清晰可见
- **非聚焦窗口**：高透明度（0.75），创造背景层次感，减少视觉干扰

### 2. 应用类型特定优化

不同类型的应用根据其使用场景获得定制的透明度设置：

#### 生产力应用（终端、编辑器）
- **聚焦时**：0.95 透明度
- **非聚焦时**：0.75-0.78 透明度（终端稍高确保可读性）

#### 系统弹窗和对话框
- **固定透明度**：不受聚焦状态影响，确保重要信息始终可见

## 详细配置规则

### 基础透明度规则

```kdl
// 聚焦窗口：低透明度
window-rule {
    match is-active=true
    opacity 0.95
}

// 非聚焦窗口：高透明度
window-rule {
    match is-active=false
    opacity 0.75
}
```

### 应用程序特定规则

#### 终端应用
- **应用**：alacritty, ghostty, rio, kitty, wezterm
- **聚焦透明度**：0.95
- **非聚焦透明度**：0.78（稍高确保文字可读性）
- **圆角**：10px（专业外观）

#### 代码编辑器
- **应用**：VSCode, Zed, VSCodium
- **聚焦透明度**：0.95
- **非聚焦透明度**：0.75
- **圆角**：12px

#### 浏览器
- **应用**：Firefox, Chrome, Chromium, Brave
- **聚焦透明度**：0.95
- **非聚焦透明度**：0.75
- **圆角**：12px

### 系统弹窗固定透明度规则

#### 文件选择器对话框
- **透明度**：0.82（固定）
- **匹配规则**：标题包含 "Open File", "Save As", "Choose", "Select", "Browse"
- **圆角**：16px
- **特效**：增强阴影效果

#### 确认和警告弹窗
- **透明度**：0.85（固定）
- **匹配规则**：zenity 应用或标题包含 "Confirm", "Warning", "Error", "Alert", "Question"
- **圆角**：16px
- **特效**：强烈阴影，突出重要性

#### 系统设置窗口
- **透明度**：0.88（固定）
- **匹配规则**：GNOME Control Center, Settings 相关应用
- **圆角**：14px

#### 通知系统
- **透明度**：0.78（固定）
- **匹配规则**：mako, dunst, 通知相关应用
- **圆角**：25px（完全胶囊形状）

#### 右键菜单和下拉菜单
- **透明度**：0.80（固定）
- **匹配规则**：rofi, dmenu, wofi 或菜单相关标题
- **圆角**：12px

### 特殊处理规则

#### 浮动窗口
- 继承基础透明度规则
- **增强效果**：更大圆角（16px）、强化阴影
- **特殊焦点环**：蓝色渐变

#### 媒体播放器
- **透明度**：0.92（固定）
- **匹配规则**：mpv, vlc, celluloid, Picture-in-Picture
- **圆角**：20px（完全胶囊效果）
- **特效**：戏剧化阴影、彩色焦点环

## 视觉效果特性

### 阴影系统
- **聚焦窗口**：更强的阴影（softness 30, spread 3）
- **非聚焦窗口**：柔和阴影（softness 20, spread 1）
- **系统弹窗**：增强阴影，创造悬浮效果

### 圆角设计
- **基础应用**：12px 圆角
- **终端应用**：10px 圆角（专业感）
- **系统弹窗**：14-16px 圆角
- **通知和媒体**：20-25px 圆角（胶囊效果）

### 焦点环
- **浮动窗口**：蓝色渐变焦点环
- **媒体播放器**：彩色渐变焦点环

## 使用建议

### 最佳实践

1. **保持工作区整洁**：透明度系统依赖视觉层次，避免窗口过度重叠
2. **合理使用浮动窗口**：浮动窗口具有增强的视觉效果，适合临时工具
3. **注意背景选择**：深色背景（如配置中的 #1c1c1e）最适合玻璃效果

### 性能考虑

- 透明度和阴影效果会增加 GPU 使用
- 在低性能设备上可适当降低阴影复杂度
- 可通过 `softness` 和 `spread` 参数调整性能/视觉平衡

### 自定义建议

如需调整特定应用的透明度：

1. 使用 `niri msg windows` 查看窗口信息
2. 根据 `app-id` 或 `title` 创建匹配规则
3. 设置合适的透明度值（0.75-0.95 范围）

## 配置文件位置

主配置文件：`/home/hengvvang/config.d/home/desktop/niri/external/niri/config.kdl`

透明度相关配置从第 595 行开始的窗口规则部分。

## 更新历史

- **2025-08-04**：实现完整的 macOS Tahoe 风格透明度系统
  - 基于聚焦状态的分层透明度
  - 应用类型特定优化
  - 系统弹窗固定透明度规则
  - 增强的视觉效果（阴影、圆角、焦点环）
