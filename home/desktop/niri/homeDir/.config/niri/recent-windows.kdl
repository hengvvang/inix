// =============================================================================
// niri 最近窗口切换器配置 (Recent Windows Switcher)
// =============================================================================
// niri 25.11+ 内置的窗口切换器，类似传统的 Alt+Tab
// 官方文档: https://github.com/YaLTeR/niri/wiki/Configuration:-Recent-Windows
//
// 功能特性:
// - 显示最近使用的窗口列表和预览
// - 支持按应用过滤窗口
// - 支持三种作用域: 所有窗口 / 当前输出 / 当前工作区
// - 可视化的窗口预览和高亮效果
// - 智能防抖，避免中间窗口污染列表
// =============================================================================

recent-windows {
    // ==========================================================================
    // 防抖延迟 (Debounce Delay)
    // ==========================================================================
    // 窗口获得焦点到提交到最近窗口列表的延迟时间(毫秒)
    //
    // 作用: 防止在导航过程中经过的中间窗口污染最近窗口列表
    // 例如:
    // - 使用键盘导航时，中间经过的窗口不会被记录
    // - 使用 focus-follows-mouse 时，鼠标经过的窗口不会被记录
    //
    // 注意: 某些操作(如键盘输入)会跳过此延迟，立即提交窗口
    //
    // 默认: 750ms
    // 设为 0: 立即提交窗口到列表(无防抖)
    debounce-ms 750

    // ==========================================================================
    // 打开延迟 (Open Delay)
    // ==========================================================================
    // 按下快捷键到切换器视觉显示的延迟时间(毫秒)
    //
    // 作用: 避免快速切换时出现闪烁的全屏视觉变化
    // - 快速点击 Alt+Tab 切换窗口时不会显示 UI
    // - 按住 Alt 浏览窗口时才会显示完整界面
    //
    // 默认: 150ms
    // 设为 0: 立即显示切换器界面
    // 建议: 100-150ms，平衡响应速度和视觉体验
    open-delay-ms 100

    // ==========================================================================
    // 高亮效果 (Highlight)
    // ==========================================================================
    // 控制焦点窗口预览后面的高亮效果
    highlight {
        // 焦点窗口高亮的普通颜色 (RGBA 格式)
        // 默认: #999999ff (灰色)
        // 建议: 使用与主题匹配的强调色
        active-color "#7aa2f7ff"  // 蓝色高亮 (Tokyo Night 风格)

        // 紧急窗口高亮颜色 (有通知的窗口)
        // 未聚焦的紧急窗口会以深色版本显示
        // 默认: #ff9999ff (浅红)
        urgent-color "#f7768eff"  // 红色高亮 (Tokyo Night 风格)

        // 高亮边距: 窗口预览周围的内边距(逻辑像素)
        // 默认: 30
        padding 30

        // 高亮圆角半径(逻辑像素)
        // 默认: 0 (直角)
        // 建议: 10-16，与窗口圆角保持一致
        corner-radius 14
    }

    // ==========================================================================
    // 窗口预览 (Previews)
    // ==========================================================================
    // 控制切换器中的窗口预览尺寸
    previews {
        // 预览窗口的最大高度(逻辑像素)
        // 在大显示器上限制预览尺寸，避免占用过多空间
        //
        // 默认: 480
        // 建议:
        // - 小显示器: 320-480
        // - 大显示器: 480-720
        // - 超大显示器: 720-1080
        max-height 480

        // 预览窗口的最大缩放比例
        // 窗口预览不会被放大超过此比例
        //
        // 限制说明:
        // - 同时限制最终窗口缩放和窗口高度
        // - 窗口高度不能超过 (显示器高度 × max-scale)
        //
        // 默认: 0.5 (50%)
        // 建议:
        // - 查看更多窗口: 0.4-0.5
        // - 查看窗口内容: 0.6-0.75
        max-scale 0.5
    }

    // ==========================================================================
    // 快捷键绑定 (Bindings)
    // ==========================================================================
    // 配置打开和导航窗口切换器的快捷键
    //
    // 重要说明:
    // 1. 这些绑定的优先级低于 binds.kdl 中的普通绑定
    // 2. 如果 binds.kdl 中有冲突的绑定，需要移除或注释掉
    // 3. 所有绑定必须包含修饰键(Alt/Mod)，因为切换器在按住修饰键时保持打开
    //
    // 可用动作:
    // - next-window: 切换到下一个窗口
    // - previous-window: 切换到上一个窗口 (反向)
    //
    // 可选属性:
    // - filter="app-id": 只显示当前应用的窗口
    // - scope="all|output|workspace": 预选作用域
    //   - all: 所有窗口(默认)
    //   - output: 当前显示器的窗口
    //   - workspace: 当前工作区的窗口
    binds {
        // ------------------------------------------------------------------
        // 基础窗口切换
        // ------------------------------------------------------------------

        // Alt+Tab: 切换到下一个窗口
        // 最常用的窗口切换快捷键
        Alt+Tab         { next-window; }

        // Alt+Shift+Tab: 切换到上一个窗口(反向)
        // 用于向后浏览窗口列表
        Alt+Shift+Tab   { previous-window; }

        // ------------------------------------------------------------------
        // 同应用窗口切换
        // ------------------------------------------------------------------

        // Alt+` (反引号): 在当前应用的窗口之间切换
        // 例如: 在多个浏览器窗口或终端窗口之间快速切换
        Alt+grave       { next-window     filter="app-id"; }

        // Alt+Shift+` (反引号): 在当前应用的窗口之间反向切换
        Alt+Shift+grave { previous-window filter="app-id"; }

        // ------------------------------------------------------------------
        // 备用绑定 (Mod 修饰键版本)
        // ------------------------------------------------------------------
        // Mod 键在 TTY 上 = Super，在 winit 窗口中 = Alt
        // 如果不需要，可以注释掉这些绑定

        // Mod+Tab: 切换到下一个窗口 (备用)
        Mod+Tab         { next-window; }

        // Mod+Shift+Tab: 切换到上一个窗口 (备用)
        Mod+Shift+Tab   { previous-window; }

        // Mod+`: 在当前应用的窗口之间切换 (备用)
        Mod+grave       { next-window     filter="app-id"; }

        // Mod+Shift+`: 在当前应用的窗口之间反向切换 (备用)
        Mod+Shift+grave { previous-window filter="app-id"; }
    }
}

// =============================================================================
// 切换器内置快捷键 (切换器打开时可用)
// =============================================================================
// 这些是硬编码的快捷键，无法在配置中修改:
//
// Esc         - 取消切换器(不切换窗口)
// Enter       - 确认切换到当前选中的窗口
// A / W / O   - 选择特定作用域 (All/Workspace/Output)
// S           - 循环切换作用域
// ← / →       - 左右移动选择
// Home / End  - 移动到第一个/最后一个窗口
//
// 此外，binds.kdl 中的某些绑定会自动在切换器中生效(仅按键，不含修饰键):
// - focus-column-left/right  -> 左右移动选择
// - focus-column-first/last  -> 移动到首尾
// - close-window            -> 关闭当前选中的窗口
// - screenshot              -> 打开截图界面
//
// 例如: 如果 binds.kdl 中有 Mod+H 绑定到 focus-column-left，
//      在切换器中按 H 就会向左移动选择
// =============================================================================

// =============================================================================
// 使用技巧
// =============================================================================
// 1. 快速切换(2个窗口):
//    - 快速按下并释放 Alt+Tab，立即切换到上一个窗口
//    - 由于有 open-delay，界面不会闪烁
//
// 2. 浏览窗口(多个窗口):
//    - 按住 Alt 键
//    - 连续按 Tab 向前浏览，按 Shift+Tab 向后浏览
//    - 释放 Alt 确认选择
//
// 3. 应用内切换:
//    - 使用 Alt+` 在同一应用的多个窗口间切换
//    - 例如: 多个终端窗口、多个浏览器窗口
//
// 4. 作用域切换:
//    - 切换器打开时按 S 循环切换作用域
//    - 或按 A/W/O 直接选择 All/Workspace/Output
//
// 5. 关闭窗口:
//    - 切换器打开时，可以直接关闭不需要的窗口
//    - 按对应的关闭窗口快捷键(不含修饰键)
// =============================================================================
