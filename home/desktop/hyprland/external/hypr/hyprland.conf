# ═══════════════════════════════════════════════════════════════
#                          Hyprland 配置文件
# ═══════════════════════════════════════════════════════════════

# ┌─────────────────────────────────────────────────────────────┐
# │                         环境变量                            │
# └─────────────────────────────────────────────────────────────┘
# Wayland 环境变量
env = XCURSOR_SIZE,24                      # 光标大小
env = QT_QPA_PLATFORM,wayland             # Qt 应用使用 Wayland
env = GDK_BACKEND,wayland,x11              # GTK 应用优先使用 Wayland
env = SDL_VIDEODRIVER,wayland              # SDL 应用使用 Wayland
env = CLUTTER_BACKEND,wayland              # Clutter 使用 Wayland
env = XDG_CURRENT_DESKTOP,Hyprland         # 桌面环境标识
env = XDG_SESSION_TYPE,wayland             # 会话类型
env = XDG_SESSION_DESKTOP,Hyprland         # 桌面会话
# 硬件加速相关
# env = WLR_NO_HARDWARE_CURSORS,1            # 禁用硬件光标（某些 GPU 需要）
env = WLR_RENDERER_ALLOW_SOFTWARE,1        # 允许软件渲染
env = LIBVA_DRIVER_NAME,nvidia             # VA-API 驱动（NVIDIA 用户）
env = __GLX_VENDOR_LIBRARY_NAME,nvidia     # OpenGL 驱动（NVIDIA 用户）
# 输入法相关
env = GTK_IM_MODULE,fcitx                  # GTK 输入法模块
env = QT_IM_MODULE,fcitx                   # Qt 输入法模块
env = XMODIFIERS,@im=fcitx                 # X11 输入法
# Firefox 相关
env = MOZ_ENABLE_WAYLAND,1                 # Firefox 使用 Wayland

# ┌─────────────────────────────────────────────────────────────┐
# │                         显示器配置                          │
# └─────────────────────────────────────────────────────────────┘
# 主显示器配置
# monitor = 显示器名称, 分辨率@刷新率, 位置, 缩放比例
monitor = eDP-1, 2560x1600@240, 0x0, 1.6      # 笔记本内置屏幕
# monitor = DP-1, 2560x1440@144, 1920x0, 1   # 外接显示器（如果存在）
# monitor = HDMI-1, disable                   # 禁用 HDMI 输出

# 默认显示器（用于未知显示器）
monitor = , preferred, auto, 1              # 自动配置未知显示器

# ┌─────────────────────────────────────────────────────────────┐
# │                         输入设备配置                        │
# └─────────────────────────────────────────────────────────────┘

input {
    # 键盘配置
    kb_layout = us                          # 键盘布局
    kb_variant =                            # 键盘变体
    kb_model =                              # 键盘型号
    kb_options = caps:escape                # 键盘选项：Caps Lock 映射为 Escape
    kb_rules =                              # 键盘规则

    # 重复按键配置
    repeat_rate = 25                        # 按键重复频率
    repeat_delay = 600                      # 按键重复延迟（毫秒）

    # 数字键盘
    numlock_by_default = true               # 默认开启数字锁定

    # 鼠标配置
    follow_mouse = 1                        # 焦点跟随鼠标: 0=禁用, 1=总是, 2=浮动窗口
    mouse_refocus = true                    # 鼠标移动时重新聚焦

    # 触摸板配置
    touchpad {
        natural_scroll = true               # 自然滚动
        disable_while_typing = true         # 打字时禁用触摸板
        middle_button_emulation = true      # 中键模拟
        tap-to-click = true                 # 轻触点击
        drag_lock = false                   # 拖拽锁定
        scroll_factor = 1.0                 # 滚动速度
    }

    # 敏感度配置
    sensitivity = 0                         # 鼠标敏感度 (-1.0 到 1.0)
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         手势配置                            │
# └─────────────────────────────────────────────────────────────┘

gestures {
    workspace_swipe = true                  # 启用工作区滑动
    workspace_swipe_fingers = 3             # 三指滑动
    workspace_swipe_distance = 300          # 滑动距离
    workspace_swipe_invert = true           # 反转滑动方向
    workspace_swipe_min_speed_to_force = 30 # 强制滑动的最小速度
    workspace_swipe_cancel_ratio = 0.5      # 取消滑动的比例
    workspace_swipe_create_new = true       # 滑动时创建新工作区
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         杂项配置                            │
# └─────────────────────────────────────────────────────────────┘

misc {
    disable_hyprland_logo = true            # 禁用 Hyprland 徽标
    disable_splash_rendering = true         # 禁用启动画面
    force_default_wallpaper = 0             # 强制默认壁纸: -1=随机, 0=不强制, 1-2=预设
    vfr = true                              # 可变刷新率
    vrr = 0                                 # 可变刷新率: 0=关闭, 1=开启, 2=仅全屏
    mouse_move_enables_dpms = true          # 鼠标移动启用显示器
    key_press_enables_dpms = true           # 按键启用显示器
    always_follow_on_dnd = true             # 拖拽时总是跟随
    layers_hog_keyboard_focus = true        # 层级抢占键盘焦点
    animate_manual_resizes = false          # 手动调整大小时动画
    enable_swallow = true                   # 启用窗口吞噬
    swallow_regex = ^(kitty|Alacritty)$     # 窗口吞噬正则表达式
    focus_on_activate = false               # 激活时聚焦
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         外观配置                            │
# └─────────────────────────────────────────────────────────────┘

general {
    # 间隙配置
    gaps_in = 5                             # 窗口内间隙
    gaps_out = 5                           # 窗口外间隙
    gaps_workspaces = 0                     # 工作区间隙

    # 边框配置
    border_size = 2                         # 边框大小
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg    # 活动边框颜色（渐变）
    col.inactive_border = rgba(595959aa)     # 非活动边框颜色

    # 调整大小配置
    resize_on_border = false                # 在边框上调整大小
    extend_border_grab_area = 15            # 扩展边框抓取区域
    hover_icon_on_border = true             # 边框上显示悬停图标

    # 布局配置
    layout = dwindle                        # 默认布局: dwindle 或 master

    # 允许撕裂
    allow_tearing = false                   # 允许屏幕撕裂（游戏性能）
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         装饰配置                            │
# └─────────────────────────────────────────────────────────────┘

decoration {
    # 圆角配置
    rounding = 10                           # 圆角半径

    # 透明度配置
    active_opacity = 1.0                    # 活动窗口透明度
    inactive_opacity = 0.9                  # 非活动窗口透明度
    fullscreen_opacity = 1.0                # 全屏窗口透明度

    # 阴影配置（在较新版本中，阴影设置移到了 decoration 之外）
    shadow {
        enabled = true                       # 启用阴影
        range = 4                           # 阴影范围
        render_power = 3                    # 阴影渲染强度
        color = rgba(1a1a1aee)              # 阴影颜色
    }

    # 模糊配置
    blur {
        enabled = true                      # 启用模糊
        size = 3                            # 模糊大小
        passes = 1                          # 模糊通道数
        new_optimizations = true            # 新优化
        xray = false                        # X光效果
        noise = 0.0117                      # 噪声
        contrast = 0.8916                   # 对比度
        brightness = 0.8172                 # 亮度
        vibrancy = 0.1696                   # 活力
        vibrancy_darkness = 0.0             # 活力暗度
        ignore_opacity = false              # 忽略透明度

        # 特殊情况
        special = false                     # 特殊工作区模糊
        popups = false                      # 弹窗模糊
        popups_ignorealpha = 0.2            # 弹窗忽略透明度阈值
    }
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         动画配置                            │
# └─────────────────────────────────────────────────────────────┘

animations {
    enabled = true                          # 启用动画

    # 贝塞尔曲线定义
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    bezier = linear, 0.0, 0.0, 1.0, 1.0
    bezier = wind, 0.05, 0.9, 0.1, 1.05
    bezier = winIn, 0.1, 1.1, 0.1, 1.1
    bezier = winOut, 0.3, -0.3, 0, 1
    bezier = slow, 0, 0.85, 0.3, 1

    # 动画定义
    animation = windows, 1, 6, wind, slide        # 窗口动画
    animation = windowsIn, 1, 6, winIn, slide     # 窗口进入动画
    animation = windowsOut, 1, 5, winOut, slide   # 窗口退出动画
    animation = windowsMove, 1, 5, wind, slide    # 窗口移动动画
    animation = border, 1, 1, linear              # 边框动画
    animation = borderangle, 1, 30, linear, loop  # 边框角度动画
    animation = fade, 1, 10, slow                 # 淡入淡出动画
    animation = workspaces, 1, 5, wind            # 工作区动画
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         Dwindle 布局                        │
# └─────────────────────────────────────────────────────────────┘

dwindle {
    pseudotile = true                       # 启用伪平铺
    preserve_split = true                   # 保持分割状态
    smart_split = false                     # 智能分割
    smart_resizing = true                   # 智能调整大小
    force_split = 0                         # 强制分割方向: 0=自动, 1=左/上, 2=右/下
    split_width_multiplier = 1.0            # 分割宽度倍数
    # no_gaps_when_only = false             # 仅一个窗口时无间隙（此选项在新版本中已移除）
    use_active_for_splits = true            # 使用活动窗口进行分割
    default_split_ratio = 1.0               # 默认分割比例
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         Master 布局                         │
# └─────────────────────────────────────────────────────────────┘

master {
    new_status = master                     # 新窗口状态: master, slave, inherit
    new_on_top = false                      # 新窗口在顶部
    # no_gaps_when_only = false             # 仅一个窗口时无间隙（此选项在新版本中已移除）
    orientation = left                      # 主窗口方向: left, right, top, bottom
    inherit_fullscreen = true               # 继承全屏状态
    # always_center_master = false          # 总是居中主窗口（此选项在新版本中已移除）
    smart_resizing = true                   # 智能调整大小
    drop_at_cursor = true                   # 在光标处放置
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         组配置                              │
# └─────────────────────────────────────────────────────────────┘

group {
    insert_after_current = true             # 在当前后插入
    focus_removed_window = true             # 聚焦移除的窗口

    col.border_active = rgba(33ccffaa)      # 活动组边框颜色
    col.border_inactive = rgba(595959aa)    # 非活动组边框颜色
    col.border_locked_active = rgba(33ccffaa)    # 锁定活动组边框颜色
    col.border_locked_inactive = rgba(595959aa)  # 锁定非活动组边框颜色

    groupbar {
        enabled = true                      # 启用组栏
        font_family = Sans                  # 字体
        font_size = 8                       # 字体大小
        gradients = true                    # 渐变
        height = 14                         # 高度
        priority = 3                        # 优先级
        render_titles = true                # 渲染标题
        scrolling = true                    # 滚动
        text_color = rgba(ffffffff)         # 文本颜色

        col.active = rgba(33ccffaa)         # 活动颜色
        col.inactive = rgba(595959aa)       # 非活动颜色
        col.locked_active = rgba(33ccffaa)  # 锁定活动颜色
        col.locked_inactive = rgba(595959aa) # 锁定非活动颜色
    }
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         窗口规则                            │
# └─────────────────────────────────────────────────────────────┘
# 浮动窗口规则
windowrulev2 = float, class:^(pavucontrol)$                    # 音量控制
windowrulev2 = float, class:^(blueman-manager)$                # 蓝牙管理器
windowrulev2 = float, class:^(nm-connection-editor)$           # 网络连接编辑器
windowrulev2 = float, class:^(galculator)$                     # 计算器
windowrulev2 = float, class:^(file-roller)$                    # 归档管理器
# 透明度规则
windowrulev2 = opacity 0.8 0.8, class:^(kitty)$               # 终端透明度
windowrulev2 = opacity 0.9 0.9, class:^(code)$                # VSCode 透明度
windowrulev2 = opacity 0.85 0.85, class:^(firefox)$           # Firefox 透明度
# 工作区规则
windowrulev2 = workspace 1, class:^(firefox)$                  # Firefox 在工作区 1
windowrulev2 = workspace 2, class:^(code)$                     # VSCode 在工作区 2
windowrulev2 = workspace 3, class:^(discord)$                  # Discord 在工作区 3
windowrulev2 = workspace 4, class:^(steam)$                    # Steam 在工作区 4
# 大小规则
windowrulev2 = size 800 600, class:^(pavucontrol)$             # 设置窗口大小
windowrulev2 = center, class:^(pavucontrol)$                   # 居中显示
# 无边框规则
windowrulev2 = noborder, class:^(firefox)$, fullscreen:1       # 全屏时无边框
# 固定规则
windowrulev2 = pin, class:^(galculator)$                       # 固定计算器
# 静音规则
windowrulev2 = suppressevent maximize, class:.*                # 抑制最大化事件

# ┌─────────────────────────────────────────────────────────────┐
# │                         层规则                              │
# └─────────────────────────────────────────────────────────────┘

layerrule = blur, rofi                      # 模糊 rofi
layerrule = ignorezero, rofi                # rofi 忽略零透明度
layerrule = blur, notifications             # 模糊通知
layerrule = ignorezero, notifications       # 通知忽略零透明度
layerrule = blur, waybar                    # 模糊状态栏
layerrule = ignorezero, waybar              # 状态栏忽略零透明度

# ┌─────────────────────────────────────────────────────────────┐
# │                         键绑定配置                          │
# └─────────────────────────────────────────────────────────────┘

# 主修饰键定义
$mainMod = SUPER                            # 主修饰键为 Super (Windows 键)

# 应用程序启动
bind = $mainMod, RETURN, exec, ghostty                        # 终端
bind = $mainMod, F, exec, nautilus                            # 文件管理器
bind = $mainMod, B, exec, zen                           # 浏览器
bind = $mainMod, slash, exec, rofi -show drun                   # 应用启动器
bind = $mainMod SHIFT, R, exec, rofi -show run              # 运行命令
bind = $mainMod, period, exec, rofi -show emoji             # emoji 选择器
# 系统控制
bind = $mainMod, Q, killactive                              # 关闭活动窗口
bind = $mainMod SHIFT, Q, exit                              # 退出 Hyprland
bind = $mainMod CTRL, F, togglefloating                          # 切换浮动
bind = $mainMod CTRL, T, pseudo                                  # 伪平铺
bind = $mainMod, J, togglesplit                             # 切换分割方向
bind = $mainMod, M, fullscreen, 1                               # 伪全屏（最大化但保持标题栏）
bind = $mainMod SHIFT, M, fullscreen                    # 全屏

# 锁屏和电源
bind = $mainMod SHIFT, L, exec, hyprlock                          # 锁屏
bind = $mainMod SHIFT, S, exec, systemctl suspend          # 挂起
bind = $mainMod SHIFT, P, exec, systemctl poweroff         # 关机
bind = $mainMod SHIFT, R, exec, systemctl reboot           # 重启

# 窗口焦点移动
bind = $mainMod, left, movefocus, l                            # 左
bind = $mainMod, right, movefocus, r                            # 右
bind = $mainMod, up, movefocus, u                            # 上
bind = $mainMod, down, movefocus, d                            # 下
bind = $mainMod, H, movefocus, l                            # 左
bind = $mainMod, L, movefocus, r                            # 右
bind = $mainMod, K, movefocus, u                            # 上
bind = $mainMod, J, movefocus, d                            # 下

# 窗口移动
bind = $mainMod SHIFT, left, movewindow, l                     # 左移
bind = $mainMod SHIFT, right, movewindow, r                     # 右移
bind = $mainMod SHIFT, up, movewindow, u                     # 上移
bind = $mainMod SHIFT, down, movewindow, d                     # 下移
bind = $mainMod SHIFT, H, movewindow, l                     # 左移
bind = $mainMod SHIFT, L, movewindow, r                     # 右移
bind = $mainMod SHIFT, K, movewindow, u                     # 上移
bind = $mainMod SHIFT, J, movewindow, d                     # 下移

# 窗口调整大小
bind = $mainMod ALT, left, resizeactive, -10 0                # 减小宽度
bind = $mainMod ALT, right, resizeactive, 10 0                 # 增加宽度
bind = $mainMod ALT, up, resizeactive, 0 -10                # 减小高度
bind = $mainMod ALT, down, resizeactive, 0 10                 # 增加高度
bind = $mainMod ALT, H, resizeactive, -10 0                # 减小宽度
bind = $mainMod ALT, L, resizeactive, 10 0                 # 增加宽度
bind = $mainMod ALT, K, resizeactive, 0 -10                # 减小高度
bind = $mainMod ALT, J, resizeactive, 0 10                 # 增加高度

# 工作区切换 (1-10)
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# 窗口移动到工作区
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10


bind = $mainMod CTRL, left, workspace, m-1
bind = $mainMod CTRL, right, workspace, m+1
bind = $mainMod CTRL, H, workspace, m-1
bind = $mainMod CTRL, L, workspace, m+1

bind = $mainMod CTRL SHIFT, left, movetoworkspace, -1
bind = $mainMod CTRL SHIFT, right, movetoworkspace, +1
bind = $mainMod CTRL SHIFT, H, movetoworkspace, -1
bind = $mainMod CTRL SHIFT, L, movetoworkspace, +1

# 特殊工作区 (便签本)
bind = $mainMod, S, togglespecialworkspace, magic           # 切换特殊工作区
bind = $mainMod SHIFT, S, movetoworkspace, special:magic    # 移动到特殊工作区

# 工作区滚动切换
bind = $mainMod, mouse_down, workspace, e+1                 # 下滚轮
bind = $mainMod, mouse_up, workspace, e-1                   # 上滚轮

# 组操作
bind = $mainMod, G, togglegroup                             # 切换组
bind = $mainMod, TAB, changegroupactive                     # 切换组内活动窗口

# 截图
bind = , Print, exec, grim                                  # 全屏截图
bind = SHIFT, Print, exec, grim -g "$(slurp)"              # 区域截图
bind = $mainMod, Print, exec, grim -g "$(slurp)" - | wl-copy  # 截图到剪贴板

# 音量控制
bind = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+      # 音量增加
bind = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-      # 音量降低
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle            # 静音切换
bind = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle       # 麦克风静音

# 亮度控制
bind = , XF86MonBrightnessUp, exec, brightnessctl set 10%+     # 亮度增加
bind = , XF86MonBrightnessDown, exec, brightnessctl set 10%-   # 亮度降低

# 媒体控制
bind = , XF86AudioPlay, exec, playerctl play-pause             # 播放/暂停
bind = , XF86AudioNext, exec, playerctl next                   # 下一首
bind = , XF86AudioPrev, exec, playerctl previous               # 上一首
bind = , XF86AudioStop, exec, playerctl stop                   # 停止

# 鼠标绑定
bindm = $mainMod, mouse:272, movewindow                        # 左键拖动窗口
bindm = $mainMod, mouse:273, resizewindow                      # 右键调整窗口大小

# ┌─────────────────────────────────────────────────────────────┐
# │                         自动启动                            │
# └─────────────────────────────────────────────────────────────┘

# 系统服务
exec-once = waybar                          # 状态栏
# exec-once = mako                            # 通知守护进程
exec-once = dunst                            # 通知守护进程
exec-once = swww init                       # 壁纸守护进程
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1  # 认证代理

# 输入法
exec-once = fcitx5 -d                       # 输入法守护进程

# 系统应用
exec-once = nm-applet --indicator           # 网络管理托盘
exec-once = blueman-applet                  # 蓝牙托盘

# 设置壁纸
exec-once = swww img ~/Pictures/wallpaper.jpg   # 设置壁纸

# 自动锁屏
exec-once = swayidle -w timeout 300 'swaylock -f' timeout 600 'hyprctl dispatch dpms off' resume 'hyprctl dispatch dpms on' before-sleep 'swaylock -f'

# 剪贴板管理器
exec-once = wl-paste --type text --watch cliphist store     # 文本剪贴板历史
exec-once = wl-paste --type image --watch cliphist store    # 图片剪贴板历史

# ┌─────────────────────────────────────────────────────────────┐
# │                         xwayland 配置                       │
# └─────────────────────────────────────────────────────────────┘

xwayland {
    use_nearest_neighbor = false            # 使用最近邻插值
    force_zero_scaling = false              # 强制零缩放
}

# ┌─────────────────────────────────────────────────────────────┐
# │                         调试配置                            │
# └─────────────────────────────────────────────────────────────┘

debug {
    overlay = false                         # 显示调试覆盖层
    damage_blink = false                    # 损坏区域闪烁
    disable_logs = true                     # 禁用日志
    disable_time = true                     # 禁用时间戳
    enable_stdout_logs = false              # 启用标准输出日志
    manual_crash = 0                        # 手动崩溃（调试用）
}
