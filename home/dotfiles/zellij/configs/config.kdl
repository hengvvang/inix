// theme "catppuccin-mocha"
// theme "dracula"
theme "tokyo-night"

default_shell "fish"

default_layout "default"

// 显示窗格边框 - 帮助区分不同的窗格
pane_frames true

// 启用鼠标模式 - 支持鼠标操作（点击、拖拽等）
mouse_mode true

// 复制命令 - 使用 Wayland 剪贴板（适用于现代 Linux 桌面）
copy_command "wl-copy"

// 剪贴板类型 - primary 表示选择即复制的剪贴板
copy_clipboard "primary"

// 滚动缓冲区编辑器 - 查看历史输出时使用的编辑器
scrollback_editor "vim"

// 会话序列化 - 保存和恢复会话状态
session_serialization true

// 自动布局 - 根据终端大小自动调整布局
auto_layout true


// 模式说明:
//   - normal: 默认模式，用于基本操作
//   - pane: 窗格管理模式
//   - tab: 标签页管理模式
//   - resize: 调整窗格大小模式
//   - scroll: 滚动浏览模式（支持搜索）
//   - search: 搜索模式（在滚动缓冲区中搜索）
//   - session: 会话管理模式
//   - move: 移动窗格位置模式
//   - locked: 锁定模式（防止误操作）
//   - renametab: 重命名标签页模式
//   - renamepane: 重命名窗格模式
//   - entersearch: 搜索输入模式

keybinds clear-defaults=true {
    normal {
        bind "Ctrl q" { Quit; }                    // 退出 Zellij
        bind "Ctrl d" { Detach; }                  // 分离会话（后台运行）

        bind "Alt h" { MoveFocus "Left"; }
        bind "Alt j" { MoveFocus "Down"; }
        bind "Alt k" { MoveFocus "Up"; }
        bind "Alt l" { MoveFocus "Right"; }

        // === 窗格分割 ===
        bind "Alt v" { NewPane "Right"; }          // 垂直分割（在右侧创建新窗格）
        bind "Alt s" { NewPane "Down"; }           // 水平分割（在下方创建新窗格）

        // === 标签页管理 ===
        bind "Alt t" { NewTab; }
        bind "Alt q" { CloseTab; }

        bind "Alt 1" { GoToTab 1; }                // 跳转到标签页 1
        bind "Alt 2" { GoToTab 2; }
        bind "Alt 3" { GoToTab 3; }
        bind "Alt 4" { GoToTab 4; }
        bind "Alt 5" { GoToTab 5; }
        bind "Alt 6" { GoToTab 6; }
        bind "Alt 7" { GoToTab 7; }
        bind "Alt 8" { GoToTab 8; }
        bind "Alt 9" { GoToTab 9; }

        bind "Ctrl l" { SwitchToMode "Locked"; }
        bind "Ctrl p" { SwitchToMode "Pane"; }
        bind "Ctrl t" { SwitchToMode "Tab"; }
        bind "Ctrl r" { SwitchToMode "Resize"; }
        bind "Ctrl m" { SwitchToMode "Move"; }
        bind "Ctrl s" { SwitchToMode "Scroll"; }
        bind "Ctrl o" { SwitchToMode "Session"; }

        bind "Ctrl f" { ToggleFocusFullscreen; }   // 切换当前窗格全屏显示
        bind "Ctrl z" { TogglePaneFrames; }        // 切换窗格边框显示
        bind "Ctrl c" { Copy; }                    // 复制模式（如果有选择的文本）


        bind "Alt n" { NewPane; }                  // 创建新窗格（自动方向）
        bind "Alt x" { CloseFocus; }               // 关闭当前焦点窗格

        bind "Alt ," { PreviousSwapLayout; }       // 上一个布局
        bind "Alt ." { NextSwapLayout; }           // 下一个布局

        bind "Alt [" { GoToPreviousTab; }          // 上一个标签页
        bind "Alt ]" { GoToNextTab; }              // 下一个标签页


        // === 会话和窗口操作 ===
        bind "Ctrl w" { SwitchToMode "Session"; }  // 快速进入会话管理模式
        bind "Ctrl e" { EditScrollback; }          // 用编辑器打开当前窗格历史
        bind "Ctrl y" { ToggleActiveSyncTab; }     // 切换同步输入到所有窗格

        // === 剪贴板和复制 ===
        bind "Ctrl Shift c" { Copy; }              // 强制复制（如果选择了文本）

        // === 高级功能 ===
        bind "Alt Tab" { SwitchFocus; }            // 在窗格间循环切换
    }

    // 窗格管理模式 (Pane Mode) - 专注于窗格操作; 进入方式: Ctrl+p，退出方式: Esc
    pane {
        bind "h" { MoveFocus "Left"; }
        bind "j" { MoveFocus "Down"; }
        bind "k" { MoveFocus "Up"; }
        bind "l" { MoveFocus "Right"; }
        bind "n" { NewPane; }
        bind "s" { NewPane "Down"; }
        bind "v" { NewPane "Right"; }
        bind "x" { CloseFocus; }
        bind "m" { ToggleFocusFullscreen; }
        bind "z" { TogglePaneFrames; }             // 切换边框显示
        bind "f" { ToggleFloatingPanes; }          // 切换浮动窗格
        bind "e" { TogglePaneEmbedOrFloating; }    // 切换窗格嵌入或浮动
        bind "r" { SwitchToMode "RenamePane"; PaneNameInput 0; } // 重命名窗格
        bind "Left" { MoveFocus "Left"; }
        bind "Right" { MoveFocus "Right"; }
        bind "Up" { MoveFocus "Up"; }
        bind "Down" { MoveFocus "Down"; }
        bind "p" { SwitchFocus; }                  // 在窗格间循环切换焦点
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 标签页管理模式 (Tab Mode) - 专注于标签页操作  // 进入方式: Ctrl+t，退出方式: Esc
    tab {
        bind "h" { GoToPreviousTab; }              // 切换到上一个标签页
        bind "l" { GoToNextTab; }                  // 切换到下一个标签页
        bind "n" { NewTab; }                       // 创建新标签页
        bind "q" { CloseTab; }                     // 关闭当前标签页
        bind "r" { SwitchToMode "RenameTab"; TabNameInput 0; } // 重命名标签页
        bind "s" { ToggleActiveSyncTab; }          // 切换同步输入到所有窗格
        bind "," { PreviousSwapLayout; }           // 上一个布局
        bind "." { NextSwapLayout; }               // 下一个布局
        bind "1" { GoToTab 1; SwitchToMode "Normal"; }  // 跳转到标签页 1 并返回普通模式
        bind "2" { GoToTab 2; SwitchToMode "Normal"; }  // 跳转到标签页 2 并返回普通模式
        bind "3" { GoToTab 3; SwitchToMode "Normal"; }  // 跳转到标签页 3 并返回普通模式
        bind "4" { GoToTab 4; SwitchToMode "Normal"; }  // 跳转到标签页 4 并返回普通模式
        bind "5" { GoToTab 5; SwitchToMode "Normal"; }  // 跳转到标签页 5 并返回普通模式
        bind "6" { GoToTab 6; SwitchToMode "Normal"; }  // 跳转到标签页 6 并返回普通模式
        bind "7" { GoToTab 7; SwitchToMode "Normal"; }  // 跳转到标签页 7 并返回普通模式
        bind "8" { GoToTab 8; SwitchToMode "Normal"; }  // 跳转到标签页 8 并返回普通模式
        bind "9" { GoToTab 9; SwitchToMode "Normal"; }  // 跳转到标签页 9 并返回普通模式
        bind "Tab" { ToggleTab; }                  // 切换到最近使用的标签页
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 窗格大小调整模式 (Resize Mode) - 精确调整窗格尺寸 // 进入方式: Ctrl+r，退出方式: Esc
    resize {
        bind "h" { Resize "Left"; }
        bind "j" { Resize "Down"; }
        bind "k" { Resize "Up"; }
        bind "l" { Resize "Right"; }
        bind "Left" { Resize "Left"; }
        bind "Down" { Resize "Down"; }
        bind "Up" { Resize "Up"; }
        bind "Right" { Resize "Right"; }
        bind "=" { Resize "Increase"; }            // 增加当前窗格大小
        bind "+" { Resize "Increase"; }            // 增加当前窗格大小
        bind "-" { Resize "Decrease"; }            // 减少当前窗格大小
        bind "_" { Resize "Decrease"; }            // 减少当前窗格大小
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 滚动浏览模式 (Scroll Mode) - 浏览历史输出 // 进入方式: Ctrl+s，退出方式: Esc
    scroll {
        bind "j" { ScrollDown; }                   // 向下滚动一行
        bind "k" { ScrollUp; }                     // 向上滚动一行
        bind "d" { HalfPageScrollDown; }           // 向下滚动半页（类似 vim）
        bind "u" { HalfPageScrollUp; }             // 向上滚动半页（类似 vim）
        bind "PageDown" { PageScrollDown; }        // 向下翻页
        bind "PageUp" { PageScrollUp; }            // 向上翻页
        bind "Down" { ScrollDown; }                // 箭头键向下
        bind "Up" { ScrollUp; }                    // 箭头键向上
        bind "Ctrl d" { HalfPageScrollDown; }      // Ctrl+d 向下滚动半页
        bind "Ctrl u" { HalfPageScrollUp; }        // Ctrl+u 向上滚动半页
        bind "Ctrl f" { PageScrollDown; }          // Ctrl+f 向下翻页
        bind "Ctrl b" { PageScrollUp; }            // Ctrl+b 向上翻页
        bind "/" { SwitchToMode "EnterSearch"; SearchInput 0; } // 搜索模式
        bind "G" { ScrollToBottom; }               // 跳转到底部
        bind "g" { ScrollToTop; }                  // 跳转到顶部
        bind "s" { SwitchToMode "Search"; }        // 进入搜索模式
        bind "e" { EditScrollback; SwitchToMode "Normal"; } // 用编辑器打开滚动缓冲区
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 会话管理模式 (Session Mode) - 管理 Zellij 会话 // 进入方式: Ctrl+o，退出方式: Esc
    session {
        bind "d" { Detach; }                       // 分离当前会话（会话继续在后台运行）
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 移动模式 (Move Mode) - 移动窗格位置 // 进入方式: Ctrl+m，退出方式: Esc
    move {
        bind "h" { MovePane "Left"; }
        bind "j" { MovePane "Down"; }
        bind "k" { MovePane "Up"; }
        bind "l" { MovePane "Right"; }
        bind "Left" { MovePane "Left"; }
        bind "Down" { MovePane "Down"; }
        bind "Up" { MovePane "Up"; }
        bind "Right" { MovePane "Right"; }
        bind "Esc" { SwitchToMode "Normal"; }      // 返回普通模式
    }

    // 锁定模式 (Locked Mode) - 防止意外按键 // 在此模式下，所有快捷键都被禁用，防止误操作
    locked {
        bind "Ctrl l" { SwitchToMode "Normal"; }   // 解锁并返回普通模式
    }

    // 重命名标签页模式 (Rename Tab Mode) - 输入新的标签页名称 // 从标签页模式按 'r' 进入此模式
    renametab {
        bind "Enter" { SwitchToMode "Normal"; }    // 确认重命名并返回普通模式
        bind "Esc" { UndoRenameTab; SwitchToMode "Normal"; } // 取消重命名并返回普通模式
    }

    // 重命名窗格模式 (Rename Pane Mode) - 输入新的窗格名称 // 从窗格模式按 'c' 进入此模式
    renamepane {
        bind "Enter" { SwitchToMode "Normal"; }    // 确认重命名并返回普通模式
        bind "Esc" { UndoRenamePane; SwitchToMode "Normal"; } // 取消重命名并返回普通模式
    }

    // 搜索模式 (Search Mode) - 在滚动缓冲区中搜索 // 从滚动模式按 '/' 进入此模式
    search {
        bind "n" { Search "down"; }                // 查找下一个匹配项
        bind "p" { Search "up"; }                  // 查找上一个匹配项
        bind "N" { Search "up"; }                  // 查找上一个匹配项（大写 N）
        bind "Esc" { SwitchToMode "Scroll"; }      // 返回滚动模式
    }

    // 进入搜索输入模式 (Enter Search Mode)
    entersearch {
        bind "Enter" { SwitchToMode "Search"; }    // 开始搜索并进入搜索模式
        bind "Esc" { SwitchToMode "Scroll"; }      // 取消搜索并返回滚动模式
    }

}


// 插件配置
plugins {
    tab-bar { path "tab-bar"; }
    status-bar { path "status-bar"; }
    strider { path "strider"; }
    compact-bar { path "compact-bar"; }
}

// 完整快捷键总结:
// ==================
// Ctrl+q     - 退出 Zellij
// Ctrl+d     - 分离会话
// Alt+hjkl   - 窗格导航
// Alt+v/s    - 垂直/水平分割
// Alt+n      - 创建新窗格（自动方向）
// Alt+c      - 新建标签页
// Alt+1-9    - 切换标签页
// Alt+ [|]    - 上一个/下一个标签页
// Alt+x      - 关闭当前标签页
// Alt+q      - 关闭窗格
// Alt+ ,|.    - 上一个/下一个布局
// Alt+Tab    - 在窗格间循环切换
// Ctrl+f     - 切换全屏
// Ctrl+z     - 切换窗格边框
// Ctrl+c     - 复制模式
// Ctrl+Shift+c - 强制复制
// Ctrl+e     - 用编辑器打开历史输出
// Ctrl+y     - 切换同步输入
// Ctrl+g     - 快速锁定
// Ctrl+w     - 快速会话管理
// F11        - 快速全屏
// F12        - 快速边框切换
//
// 模式切换快捷键:
// ===============
// Ctrl+p     - 窗格管理模式
// Ctrl+t     - 标签页管理模式
// Ctrl+r     - 调整大小模式
// Ctrl+s     - 滚动浏览模式（支持搜索: /）
// Ctrl+o     - 会话管理模式
// Ctrl+m     - 移动模式
// Ctrl+l     - 锁定模式
// Esc        - 返回普通模式
//
// 滚动模式功能 (Ctrl+s):
// ====================
// j/k        - 上下滚动
// d/u        - 半页滚动
// g/G        - 跳转到顶部/底部
// Ctrl+f/b   - 翻页滚动
// Up/Down    - 箭头键滚动
// /          - 搜索文本
// s          - 进入搜索模式
// e          - 用编辑器打开历史输出
// PageUp/Down - 翻页
// Esc        - 返回普通模式
//
// 搜索模式功能 (从滚动模式按 /):
// =============================
// n/p/N      - 下一个/上一个匹配
// Esc        - 返回滚动模式
//
// 窗格管理模式功能 (Ctrl+p):
// =========================
// hjkl       - 移动焦点
// 箭头键      - 移动焦点
// n/d/c      - 新建窗格（自动/下方/右侧）
// x          - 关闭窗格
// m          - 切换全屏
// z          - 切换边框
// f          - 切换浮动窗格
// e          - 切换嵌入/浮动
// r          - 重命名窗格
// p          - 循环切换窗格焦点
// Esc        - 返回普通模式
//
// 标签页管理模式功能 (Ctrl+t):
// ===========================
// h/l        - 上一个/下一个标签页
// n          - 新建标签页
// x          - 关闭标签页
// r          - 重命名标签页
// s          - 切换同步输入
// [/]        - 切换布局
// 1-9        - 跳转到指定标签页
// Tab        - 切换到最近标签页
// Esc        - 返回普通模式
//
// 调整大小模式功能 (Ctrl+r):
// =========================
// hjkl       - Vi风格调整
// 箭头键      - 调整窗格边界
// +/=        - 增加窗格大小
// -/_        - 减少窗格大小
// Esc        - 返回普通模式
//
// 移动模式功能 (Ctrl+m):
// =====================
// hjkl       - Vi风格移动窗格
// 箭头键      - 移动窗格位置
// Esc        - 返回普通模式
//
// 会话管理模式功能 (Ctrl+o):
// =========================
// d          - 分离会话
// Esc        - 返回普通模式
//
// 锁定模式功能 (Ctrl+l):
// =====================
// Ctrl+l     - 解锁回到普通模式
//
// 重命名模式功能:
// ==============
// Enter      - 确认重命名
// Esc        - 取消重命名
//
// 插件说明:
// =========
// tab-bar    - 标签页栏插件
// status-bar - 状态栏插件
// strider    - 文件浏览器插件
// compact-bar- 紧凑状态栏插件
