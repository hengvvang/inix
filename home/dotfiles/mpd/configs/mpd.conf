# MPD 主配置文件
# Music Player Daemon Configuration
# 这是一个标准的 MPD 配置文件模板

# === 基本路径配置 ===
music_directory    "~/Music"
playlist_directory "~/.config/mpd/playlists"
db_file            "~/.config/mpd/database"
log_file           "~/.config/mpd/log"
pid_file           "~/.config/mpd/pid"
state_file         "~/.config/mpd/state"
sticker_file       "~/.config/mpd/sticker.sql"

# === 网络配置 ===
bind_to_address "localhost"
# bind_to_address "0.0.0.0"  # 取消注释以允许远程连接
port "6600"

# === 用户配置 ===
# user "mpd"  # 在用户级运行时通常不需要

# === 音频输出配置 ===

# PipeWire 输出（推荐）
audio_output {
    type        "pipewire"
    name        "PipeWire Output"
}

# PulseAudio 输出（备用）
audio_output {
    type        "pulse"
    name        "PulseAudio Output"
    # server    "unix:/run/user/1000/pulse/native"  # 可选：指定 PulseAudio 服务器
}

# ALSA 输出（低级别）
# audio_output {
#     type        "alsa"
#     name        "ALSA Output"
#     device      "hw:0,0"
#     mixer_type  "hardware"
#     mixer_device "default"
#     mixer_control "PCM"
# }

# HTTP 音频流输出
audio_output {
    type        "httpd"
    name        "HTTP Audio Stream"
    encoder     "lame"              # 或 "vorbis", "flac"
    port        "8000"
    bitrate     "192"               # 128, 192, 256, 320
    format      "44100:16:2"
    always_on   "yes"
    tags        "yes"
}

# FIFO 输出（用于可视化工具）
audio_output {
    type        "fifo"
    name        "FIFO Output"
    path        "/tmp/mpd.fifo"
    format      "44100:16:2"
}

# === 文件系统配置 ===
filesystem_charset "UTF-8"

# === 元数据配置 ===
metadata_to_use "artist,album,title,track,name,genre,date,composer,performer,disc,albumartist"

# === 自动更新配置 ===
auto_update "yes"
auto_update_depth "3"

# === 符号链接配置 ===
follow_outside_symlinks "yes"
follow_inside_symlinks "yes"

# === 混音器配置 ===
mixer_type "software"
# mixer_type "hardware"  # 如果使用硬件混音器

# === 重播增益配置 ===
replaygain "auto"                # off, album, track, auto
replaygain_preamp "0"           # dB
replaygain_missing_preamp "0"   # dB
replaygain_limit "yes"

# === 日志配置 ===
log_level "notice"              # notice, info, verbose, debug

# === 输入插件配置 ===
input {
    plugin "curl"
}

# === 解码器插件配置 ===

# MP3 解码器
decoder {
    plugin "mad"
    enabled "yes"
}

# Ogg Vorbis 解码器
decoder {
    plugin "vorbis"
    enabled "yes"
}

# FLAC 解码器
decoder {
    plugin "flac"
    enabled "yes"
}

# FFmpeg 解码器（支持多种格式）
decoder {
    plugin "ffmpeg"
    enabled "yes"
}

# === 重采样配置 ===
# resampler {
#     plugin "libsamplerate"
#     type "Best Sinc Interpolator"
# }

# === 缓冲区配置 ===
# audio_buffer_size "4096"
# buffer_before_play "10%"

# === 其他高级设置 ===
# max_playlist_length "16384"
# max_command_list_size "2048"
# max_output_buffer_size "8192"
# connection_timeout "60"
# max_connections "10"

# === 音量正常化 ===
# volume_normalization "no"

# === 音频格式配置 ===
# audio_output_format "44100:16:2"

# === 数据库配置 ===
# database {
#     plugin "simple"
#     path "~/.config/mpd/database"
# }

# === 存储器配置 ===
# save_absolute_paths_in_playlists "no"
